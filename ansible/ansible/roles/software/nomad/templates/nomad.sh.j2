#!/bin/bash
# {{ ansible_managed }}

bind_addr = "{{ ansible_eth1.ipv4.address }}"
data_dir = "/opt/nomad"
log_level = "DEBUG"

telemetry {
  collection_interval = "1s"
  disable_hostname = true
  prometheus_metrics = true
  publish_allocation_metrics = true
  publish_node_metrics = true
}

{% if ansible_hostname == 'SERVER' %}
    name = "server"
    server {
        enabled = true
        bootstrap_expect = 1
    }
{% else %}
    client {
        enabled = true
        servers = ["192.168.1.2"]
        network_interface = "eth1"
    }

    {% if ansible_hostname == 'CLIENT1' %}
        name = "client1"
    {% else %}
        name = "client2"
    {% endif %}
{% endif %}
